"use strict";(self["webpackChunkdesign_notes"]=self["webpackChunkdesign_notes"]||[]).push([[775],{775:function(t,e,i){i.r(e),i.d(e,{default:function(){return F}});var o=i(641),s=i(751);const r={class:"generator-container"},a={key:0,class:"content-section"},n={class:"metadata-section"},c={class:"checkbox-field"},l={class:"prompt-section"},h={class:"text-section"},d={class:"button-group"};function g(t,e,i,g,p,u){const m=(0,o.g2)("BaseButton"),b=(0,o.g2)("TextField"),y=(0,o.g2)("SelectField"),S=(0,o.g2)("TextAreaField"),f=(0,o.g2)("SubmitButton");return(0,o.uX)(),(0,o.CE)("div",r,[e[8]||(e[8]=(0,o.Lk)("h1",null,"Запись конпсекта",-1)),t.isAuthenticated?((0,o.uX)(),(0,o.CE)("div",a,[(0,o.Lk)("div",n,[(0,o.bF)(b,{id:"title",label:"Заголовок:",modelValue:p.title,"onUpdate:modelValue":e[0]||(e[0]=t=>p.title=t),placeholder:"Введите заголовок",error:p.errors.title},{button:(0,o.k6)((()=>[(0,o.bF)(m,{onClick:u.handleTitleMagic,icon:"wand_stars",iconOnly:""},null,8,["onClick"])])),_:1},8,["modelValue","error"]),(0,o.bF)(b,{id:"description",label:"Описание:",modelValue:p.description,"onUpdate:modelValue":e[1]||(e[1]=t=>p.description=t),placeholder:"Введите описание",error:p.errors.description},{button:(0,o.k6)((()=>[(0,o.bF)(m,{onClick:u.handleDescriptionMagic,icon:"wand_stars",iconOnly:""},null,8,["onClick"])])),_:1},8,["modelValue","error"]),(0,o.bF)(y,{id:"category",label:"Категория:",modelValue:p.category,"onUpdate:modelValue":e[2]||(e[2]=t=>p.category=t),options:p.categoryOptions,"is-loading":p.isLoadingCategories,error:p.errors.category},null,8,["modelValue","options","is-loading","error"]),(0,o.Lk)("div",c,[(0,o.bo)((0,o.Lk)("input",{type:"checkbox",id:"isPublic","onUpdate:modelValue":e[3]||(e[3]=t=>p.isPublic=t)},null,512),[[s.lH,p.isPublic]]),e[6]||(e[6]=(0,o.Lk)("label",{for:"isPublic"},"Сделать публичным",-1))])]),(0,o.Lk)("div",l,[(0,o.bF)(S,{id:"prompt",label:"Промпт:",modelValue:p.prompt,"onUpdate:modelValue":e[4]||(e[4]=t=>p.prompt=t),placeholder:"Введите промпт для форматирования текста",error:p.errors.prompt},null,8,["modelValue","error"]),(0,o.bF)(m,{onClick:u.formatText,class:"format-button",icon:"wand_stars",iconOnly:""},null,8,["onClick"])]),(0,o.Lk)("div",h,[(0,o.bF)(S,{id:"content",label:"Текст:",modelValue:p.content,"onUpdate:modelValue":e[5]||(e[5]=t=>p.content=t),placeholder:"Введите или вставьте текст для форматирования",error:p.errors.content},null,8,["modelValue","error"])]),(0,o.Lk)("div",d,[(0,o.bF)(f,{"is-submitting":p.isSubmitting,text:"Сохранить",icon:"save",onClick:u.saveContent},null,8,["is-submitting","onClick"]),(0,o.bF)(m,{variant:"clear",onClick:u.clearForm,icon:"delete"},{default:(0,o.k6)((()=>e[7]||(e[7]=[(0,o.eW)("Очистить форму")]))),_:1},8,["onClick"])])])):(0,o.Q3)("",!0)])}var p=i(818),u=i(640),m=i(929),b=i(682),y=i(858),S=(i(490),i(278)),f={name:"GeneratorView",components:{BaseButton:p.A,SubmitButton:u.A,TextField:m.A,SelectField:b.A,TextAreaField:y.A},data(){return{isSubmitting:!1,prompt:this.loadFromStorage()?.prompt||"",content:this.loadFromStorage()?.content||"",title:this.loadFromStorage()?.title||"",description:this.loadFromStorage()?.description||"",category:this.loadFromStorage()?.category||"",isPublic:this.loadFromStorage()?.isPublic||!1,categoryOptions:[],isLoadingCategories:!1,generatedText:"",isGenerating:!1,errors:{title:"",description:"",category:"",content:"",prompt:""}}},computed:{...(0,S.aH)("notes",["loading"]),...(0,S.L8)("auth",["isAuthenticated"]),...(0,S.L8)("notes",["categories"])},created(){this.checkAuth()},watch:{prompt(t){this.saveToStorage(),this.errors.prompt&&(this.errors.prompt="")},content(t){this.saveToStorage(),this.errors.content&&(this.errors.content="")},title(t){this.saveToStorage(),this.errors.title&&(this.errors.title="")},description(t){this.saveToStorage(),this.errors.description&&(this.errors.description="")},category(t){this.saveToStorage(),this.errors.category&&(this.errors.category="")},isPublic(t){this.saveToStorage()}},methods:{...(0,S.i0)("notes",["createNote","formatNote","fetchCategories"]),...(0,S.i0)("ui",["openAuthModal","closeAuthModal","addNotification"]),checkAuth(){const t=localStorage.getItem("token"),e=localStorage.getItem("user");t&&e?this.isAuthenticated&&this.loadCategories():this.openAuthModal()},saveToStorage(){const t={prompt:this.prompt,content:this.content,title:this.title,description:this.description,category:this.category,isPublic:this.isPublic};localStorage.setItem("generator_data",JSON.stringify(t))},loadFromStorage(){const t=localStorage.getItem("generator_data");return t?JSON.parse(t):null},clearStorage(){localStorage.removeItem("generator_data")},async loadCategories(){try{this.isLoadingCategories=!0,await this.fetchCategories(),this.categoryOptions=this.categories.map((t=>({value:t.name,label:t.name})))}catch(t){console.error("Ошибка загрузки категорий:",t)}finally{this.isLoadingCategories=!1}},async formatText(){if(this.prompt.trim())if(this.content.trim())try{const t=await this.formatNote({text:this.content,prompt:this.prompt});this.content=t,this.addNotification({message:"Текст успешно отформатирован",type:"success"})}catch(t){console.error("Ошибка при форматировании:",t),this.addNotification({message:"Ошибка при форматировании",type:"error"})}else this.errors.content="Текст обязателен";else this.errors.prompt="Промпт обязателен"},validateForm(){this.errors={title:"",description:"",category:"",content:"",prompt:""};let t=!0;return this.title.trim()||(this.errors.title="Заголовок обязателен",t=!1),this.description.trim()||(this.errors.description="Описание обязательно",t=!1),this.category||(this.errors.category="Категория обязательна",t=!1),this.content.trim()||(this.errors.content="Текст обязателен",t=!1),t},async saveContent(){if(this.validateForm()&&!this.isSubmitting){this.isSubmitting=!0;try{const t=JSON.parse(localStorage.getItem("user")),e={title:this.title.trim(),description:this.description.trim(),category:String(this.category),userId:t.id,isPublic:Boolean(this.isPublic),text:String(this.content.trim())};await this.createNote(e),this.addNotification({message:"Текст успешно сохранен",type:"success"}),this.clearForm()}catch(t){console.error("Ошибка при сохранении:",t),this.addNotification({message:"Ошибка при сохранении",type:"error"})}finally{this.isSubmitting=!1}}},clearForm(){this.prompt="",this.content="",this.title="",this.description="",this.category="",this.isPublic=!1,this.clearStorage()},handleAuthClose(){this.closeAuthModal()},handleAuthSuccess(){this.closeAuthModal(),this.loadCategories()},async handleGenerate(){if(this.isAuthenticated){this.isSubmitting=!0;try{const t=await this.formatNote({text:this.content,prompt:this.prompt});this.content=t}catch(t){console.error("Ошибка при генерации текста:",t)}finally{this.isSubmitting=!1}}else this.openAuthModal()},async handleSave(){if(this.isAuthenticated){this.isSubmitting=!0;try{const t={title:"Сгенерированная заметка",description:"Заметка, созданная с помощью генератора",category:this.category,userId:0,isPublic:!1,text:this.content};await this.createNote(t),this.clearForm()}catch(t){console.error("Ошибка при сохранении заметки:",t)}finally{this.isSubmitting=!1}}else this.openAuthModal()},handleTitleMagic(){if(!this.content)return void this.addNotification({message:"В тексте должен быть заголовок перового уровня",type:"error"});const t=this.content.match(/^#\s+(.+)$/m);t&&t[1]?(this.title=t[1].trim(),this.addNotification({message:"Заголовок успешно извлечен",type:"success"})):this.addNotification({message:"Заголовок первого уровня не найден",type:"warning"})},handleDescriptionMagic(){if(!this.content)return void this.addNotification({message:"В поле Текст нет текста",type:"error"});let t=this.content.replace(/^#+\s+.+$/gm,"");t=t.replace(/\*\*(.*?)\*\*/g,"$1").replace(/\*(.*?)\*/g,"$1").replace(/`(.*?)`/g,"$1").replace(/\[(.*?)\]\(.*?\)/g,"$1").replace(/^\s*[-*+]\s+/gm,"").replace(/^\s*\d+\.\s+/gm,"").trim(),t?(this.description=t.length>100?t.substring(0,100)+"...":t,this.addNotification({message:"Описание успешно извлечено",type:"success"})):this.addNotification({message:"Не удалось извлечь описание",type:"warning"})}}},k=i(262);const v=(0,k.A)(f,[["render",g],["__scopeId","data-v-6e359090"]]);var F=v}}]);
//# sourceMappingURL=775.ac50b908.js.map