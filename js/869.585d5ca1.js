(self["webpackChunkdesign_notes"]=self["webpackChunkdesign_notes"]||[]).push([[869],{124:function(t,e,i){var n=i(325),o=function(){return n.Date.now()};t.exports=o},128:function(t,e,i){var n=i(800),o=/^\s+/;function a(t){return t?t.slice(0,n(t)+1).replace(o,""):t}t.exports=a},221:function(t,e,i){var n=i(805),o=i(124),a=i(374),s="Expected a function",r=Math.max,d=Math.min;function l(t,e,i){var l,c,u,h,f,m,g=0,v=!1,p=!1,k=!0;if("function"!=typeof t)throw new TypeError(s);function y(e){var i=l,n=c;return l=c=void 0,g=e,h=t.apply(n,i),h}function C(t){return g=t,f=setTimeout(N,e),v?y(t):h}function b(t){var i=t-m,n=t-g,o=e-i;return p?d(o,u-n):o}function w(t){var i=t-m,n=t-g;return void 0===m||i>=e||i<0||p&&n>=u}function N(){var t=o();if(w(t))return L(t);f=setTimeout(N,b(t))}function L(t){return f=void 0,k&&l?y(t):(l=c=void 0,h)}function x(){void 0!==f&&clearTimeout(f),g=0,l=m=c=f=void 0}function S(){return void 0===f?h:L(o())}function E(){var t=o(),i=w(t);if(l=arguments,c=this,m=t,i){if(void 0===f)return C(m);if(p)return clearTimeout(f),f=setTimeout(N,e),y(m)}return void 0===f&&(f=setTimeout(N,e)),h}return e=a(e)||0,n(i)&&(v=!!i.leading,p="maxWait"in i,u=p?r(a(i.maxWait)||0,e):u,k="trailing"in i?!!i.trailing:k),E.cancel=x,E.flush=S,E}t.exports=l},325:function(t,e,i){var n=i(840),o="object"==typeof self&&self&&self.Object===Object&&self,a=n||o||Function("return this")();t.exports=a},346:function(t){function e(t){return null!=t&&"object"==typeof t}t.exports=e},350:function(t){var e=Object.prototype,i=e.toString;function n(t){return i.call(t)}t.exports=n},374:function(t,e,i){var n=i(128),o=i(805),a=i(394),s=NaN,r=/^[-+]0x[0-9a-f]+$/i,d=/^0b[01]+$/i,l=/^0o[0-7]+$/i,c=parseInt;function u(t){if("number"==typeof t)return t;if(a(t))return s;if(o(t)){var e="function"==typeof t.valueOf?t.valueOf():t;t=o(e)?e+"":e}if("string"!=typeof t)return 0===t?t:+t;t=n(t);var i=d.test(t);return i||l.test(t)?c(t.slice(2),i?2:8):r.test(t)?s:+t}t.exports=u},394:function(t,e,i){var n=i(552),o=i(346),a="[object Symbol]";function s(t){return"symbol"==typeof t||o(t)&&n(t)==a}t.exports=s},552:function(t,e,i){var n=i(873),o=i(659),a=i(350),s="[object Null]",r="[object Undefined]",d=n?n.toStringTag:void 0;function l(t){return null==t?void 0===t?r:s:d&&d in Object(t)?o(t):a(t)}t.exports=l},659:function(t,e,i){var n=i(873),o=Object.prototype,a=o.hasOwnProperty,s=o.toString,r=n?n.toStringTag:void 0;function d(t){var e=a.call(t,r),i=t[r];try{t[r]=void 0;var n=!0}catch(d){}var o=s.call(t);return n&&(e?t[r]=i:delete t[r]),o}t.exports=d},800:function(t){var e=/\s/;function i(t){var i=t.length;while(i--&&e.test(t.charAt(i)));return i}t.exports=i},805:function(t){function e(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)}t.exports=e},840:function(t,e,i){var n="object"==typeof i.g&&i.g&&i.g.Object===Object&&i.g;t.exports=n},869:function(t,e,i){"use strict";i.r(e),i.d(e,{default:function(){return T}});var n=i(641),o=i(33),a=i(751);const s={class:"note-header"},r={class:"note-title"},d={class:"file-name"},l={class:"note-meta"},c={class:"category-badge"},u={class:"date"},h={key:1,class:"auth-message"},f={class:"note-content"},m={class:"preview-column"},g=["innerHTML"],v={key:0,class:"button-group"},p={class:"draft-modal-content"},k={class:"draft-modal-buttons"};function y(t,e,i,y,C,b){const w=(0,n.g2)("StateView"),N=(0,n.g2)("BaseButton"),L=(0,n.g2)("TextField"),x=(0,n.g2)("SelectField"),S=(0,n.g2)("SubmitButton"),E=(0,n.g2)("Modal");return(0,n.uX)(),(0,n.CE)("div",{class:(0,o.C4)(["note-container",{"is-editing":C.isEditing}])},[b.isLoading?((0,n.uX)(),(0,n.Wv)(w,{key:0,title:"Загрузка конспекта",message:"Пожалуйста, подождите...","animation-src":"/assets/animations/loader_2.riv"})):C.error?((0,n.uX)(),(0,n.Wv)(w,{key:1,title:C.error.title,"Я":"",message:C.error.message,"animation-src":"/assets/animations/loader_2.riv"},null,8,["title","message"])):b.note?((0,n.uX)(),(0,n.CE)(n.FK,{key:2},[(0,n.Lk)("div",s,[(0,n.Lk)("h1",r,[(0,n.Lk)("span",d,(0,o.v_)(b.note.title),1)]),(0,n.Lk)("div",l,[(0,n.Lk)("span",c,(0,o.v_)(b.note.category),1),(0,n.Lk)("span",u,"Обновлено: "+(0,o.v_)(b.formattedDate),1),t.isAuthenticated?((0,n.uX)(),(0,n.CE)(n.FK,{key:0},[C.isEditing?((0,n.uX)(),(0,n.CE)(n.FK,{key:1},[(0,n.bF)(N,{variant:"primary",size:"medium",icon:"save",disabled:!t.isAuthenticated,onClick:b.toggleEditing,iconOnly:""},null,8,["disabled","onClick"]),(0,n.bF)(N,{variant:"outline",size:"medium",icon:"undo",disabled:!t.isAuthenticated,onClick:b.clearForm,iconOnly:""},null,8,["disabled","onClick"])],64)):((0,n.uX)(),(0,n.Wv)(N,{key:0,variant:"outline",size:"medium",icon:"edit",disabled:!t.isAuthenticated,onClick:b.toggleEditing,iconOnly:""},null,8,["disabled","onClick"]))],64)):((0,n.uX)(),(0,n.CE)("span",h,[(0,n.Lk)("a",{href:"#",class:"auth-link",onClick:e[0]||(e[0]=(0,a.D$)((t=>this.openAuthModal()),["prevent"]))},"Авторизуйтесь"),e[6]||(e[6]=(0,n.eW)(" для редактирования "))]))])]),(0,n.Lk)("div",{class:(0,o.C4)(["metadata-section",{"is-active":C.isEditing}])},[(0,n.bF)(L,{id:"title",label:"Заголовок:",modelValue:C.editedNote.title,"onUpdate:modelValue":e[1]||(e[1]=t=>C.editedNote.title=t),placeholder:"Введите заголовок"},null,8,["modelValue"]),(0,n.bF)(L,{id:"description",label:"Описание:",modelValue:C.editedNote.description,"onUpdate:modelValue":e[2]||(e[2]=t=>C.editedNote.description=t),placeholder:"Введите описание"},null,8,["modelValue"]),(0,n.bF)(x,{id:"category",label:"Категория:",modelValue:C.editedNote.category,"onUpdate:modelValue":e[3]||(e[3]=t=>C.editedNote.category=t),options:C.categoryOptions,"is-loading":C.isLoadingCategories},null,8,["modelValue","options","is-loading"])],2),(0,n.Lk)("div",f,[(0,n.Lk)("div",{class:(0,o.C4)(["editor-column",{"is-active":C.isEditing}])},[(0,n.bo)((0,n.Lk)("textarea",{"onUpdate:modelValue":e[4]||(e[4]=t=>C.markdownContent=t),class:"markdown-editor",placeholder:"Введите текст в формате Markdown...",onInput:e[5]||(e[5]=(...t)=>b.handleContentChange&&b.handleContentChange(...t))},null,544),[[a.Jo,C.markdownContent]])],2),(0,n.Lk)("div",m,[(0,n.Lk)("div",{class:"markdown-content",innerHTML:b.compiledMarkdown},null,8,g)])]),C.isEditing?((0,n.uX)(),(0,n.CE)("div",v,[(0,n.bF)(S,{"is-submitting":C.isSubmitting,text:"Сохранить",icon:"save",onClick:b.saveNote},null,8,["is-submitting","onClick"]),(0,n.bF)(N,{variant:"clear",onClick:b.clearForm,icon:"delete"},{default:(0,n.k6)((()=>e[7]||(e[7]=[(0,n.eW)("Очистить форму")]))),_:1},8,["onClick"])])):(0,n.Q3)("",!0)],64)):((0,n.uX)(),(0,n.Wv)(w,{key:3,title:"Конспект не найден",message:"К сожалению, запрашиваемый конспект не существует или был удален","animation-src":"/assets/animations/loader_2.riv"})),(0,n.bF)(E,{show:C.showDraftModal,title:"Восстановить черновик?",onClose:b.handleDraftModalClose},{default:(0,n.k6)((()=>[(0,n.Lk)("div",p,[e[10]||(e[10]=(0,n.Lk)("p",null,"Найден черновик этой заметки. Хотите восстановить его?",-1)),(0,n.Lk)("div",k,[(0,n.bF)(N,{variant:"secondary",size:"medium",class:"draft-modal-button",onClick:b.handleDraftModalClose},{default:(0,n.k6)((()=>e[8]||(e[8]=[(0,n.eW)(" Отмена ")]))),_:1},8,["onClick"]),(0,n.bF)(N,{variant:"primary",size:"medium",class:"draft-modal-button",onClick:b.handleDraftRestore},{default:(0,n.k6)((()=>e[9]||(e[9]=[(0,n.eW)(" Восстановить ")]))),_:1},8,["onClick"])])])])),_:1},8,["show","onClose"])],2)}var C=i(278),b=i(404),w=i(906);const N={class:"modal-header"},L={class:"modal-title"},x={class:"modal-content"};function S(t,e,i,s,r,d){const l=(0,n.g2)("BaseButton");return(0,n.uX)(),(0,n.Wv)(a.eB,{name:"modal"},{default:(0,n.k6)((()=>[i.show?((0,n.uX)(),(0,n.CE)("div",{key:0,class:"modal-overlay",onClick:e[1]||(e[1]=(...t)=>d.handleOverlayClick&&d.handleOverlayClick(...t))},[(0,n.Lk)("div",{class:"modal-container",onClick:e[0]||(e[0]=(0,a.D$)((()=>{}),["stop"]))},[(0,n.Lk)("div",N,[(0,n.Lk)("h2",L,(0,o.v_)(i.title),1),i.closable?((0,n.uX)(),(0,n.Wv)(l,{key:0,variant:"outline",size:"small",class:"modal-close",onClick:d.handleClose},{default:(0,n.k6)((()=>e[2]||(e[2]=[(0,n.Lk)("span",{class:"close-icon"},"×",-1)]))),_:1},8,["onClick"])):(0,n.Q3)("",!0)]),(0,n.Lk)("div",x,[(0,n.RG)(t.$slots,"default",{},void 0,!0)])])])):(0,n.Q3)("",!0)])),_:3})}var E=i(818),A={name:"Modal",components:{BaseButton:E.A},props:{show:{type:Boolean,required:!0},title:{type:String,default:""},closable:{type:Boolean,default:!0}},methods:{handleClose(){this.$emit("close")},handleOverlayClick(){this.closable&&this.handleClose()}}},M=i(262);const _=(0,M.A)(A,[["render",S],["__scopeId","data-v-dba1edc0"]]);var F=_,D=i(221),O=i.n(D),B=i(640),I=i(929),j=i(682),V={name:"NoteView",components:{StateView:w.A,Modal:F,BaseButton:E.A,SubmitButton:B.A,TextField:I.A,SelectField:j.A},props:{id:{type:[String,Number],required:!0}},data(){return{markdownContent:"",markedInstance:b.xI,error:null,isEditing:!1,hasUnsavedChanges:!1,showDraftModal:!1,draftContent:"",editedNote:{title:"",description:"",category:"",text:""},isSubmitting:!1,categoryOptions:[],isLoadingCategories:!1}},computed:{...(0,C.aH)("notes",["loading"]),...(0,C.L8)("notes",["currentNote","categories"]),...(0,C.L8)("auth",["isAuthenticated"]),isLoading(){return this.loading},note(){return this.currentNote},compiledMarkdown(){return this.markdownContent?this.markedInstance.parse(this.markdownContent):""},formattedDate(){return this.note?new Date(this.note.date).toLocaleString():""}},watch:{id:{immediate:!0,handler(){this.error=null,this.fetchNoteData()}}},created(){this.initMarked(),this.saveDraft=O()(this._saveDraft,500),this.fetchNoteData()},methods:{...(0,C.i0)("notes",["fetchNoteById","updateNote","deleteNote","formatNote"]),...(0,C.i0)("files",["fetchMarkdownFile"]),...(0,C.i0)("ui",["addNotification","openAuthModal","closeAuthModal"]),initMarked(){this.markedInstance.setOptions({sanitize:!0,breaks:!0,gfm:!0,highlight(t){return t}})},async fetchNoteData(){try{if(await this.fetchNoteById(this.id),!this.currentNote)return void(this.error={title:"Конспект не найден",message:"Запрашиваемый конспект не существует или был удален"});if(this.currentNote?.file){const t=await this.fetchMarkdownFile(this.currentNote.file);console.log("fileContent",t),this.markdownContent=t,this.checkForDraft()}this.editedNote={title:this.currentNote.title||"",description:this.currentNote.description||"",category:this.currentNote.category||"",text:this.currentNote.text||""},this.categoryOptions=this.categories.map((t=>({value:t.id,label:t.name})))}catch(t){console.error("Error fetching note data:",t),this.error={title:"Ошибка загрузки заметки",message:t.response?.data?.message||t.message||"Произошла ошибка при загрузке заметки"}}},checkForDraft(){const t=localStorage.getItem(`draftNote_${this.id}`);t&&(this.draftContent=t,this.showDraftModal=!0)},handleContentChange(){this.hasUnsavedChanges=!0,this.saveDraft()},_saveDraft(){localStorage.setItem(`draftNote_${this.id}`,this.markdownContent)},async toggleEditing(t=!0){if(this.isAuthenticated){if(this.isEditing&&t)try{await this.updateNote({id:this.id,data:this.editedNote}),localStorage.removeItem(`draftNote_${this.id}`),this.hasUnsavedChanges=!1,this.addNotification({message:"Заметка успешно сохранена",type:"success"})}catch(e){return console.error("Error saving note:",e),void this.addNotification({message:e.response?.data?.message||e.message||"Произошла ошибка при сохранении заметки",type:"error"})}this.isEditing=!this.isEditing}else this.openAuthModal()},handleDraftModalClose(){this.showDraftModal=!1,this.draftContent=""},handleDraftRestore(){this.markdownContent=this.draftContent,this.hasUnsavedChanges=!0,this.showDraftModal=!1,this.draftContent="",this.toggleEditing(!1)},checkAuth(){return this.isAuthenticated},handleAuthSuccess(){this.closeAuthModal(),this.startEditing()},handleAuthClose(){this.closeAuthModal()},async handleUpdate(){try{await this.updateNote({id:this.note.id,data:this.editedNote}),this.isEditing=!1}catch(t){console.error("Ошибка при обновлении заметки:",t)}},async handleDelete(){if(confirm("Вы уверены, что хотите удалить эту заметку?"))try{await this.deleteNote(this.note.id),this.$router.push("/")}catch(t){console.error("Ошибка при удалении заметки:",t)}},async handleFormat(){try{const t=await this.formatNote({text:this.editedNote.text,prompt:"Отформатируй текст"});this.editedNote.text=t}catch(t){console.error("Ошибка при форматировании текста:",t)}},startEditing(){this.isAuthenticated?(this.editedNote={title:this.note.title,description:this.note.description,category:this.note.category,text:this.note.text},this.isEditing=!0):this.openAuthModal()},cancelEditing(){this.isEditing=!1},async saveNote(){this.isSubmitting=!0;try{await this.updateNote({id:this.note.id,data:this.editedNote}),this.isEditing=!1,this.hasUnsavedChanges=!1,localStorage.removeItem(`draftNote_${this.id}`),this.addNotification({message:"Заметка успешно сохранена",type:"success"})}catch(t){console.error("Ошибка при сохранении заметки:",t),this.addNotification({message:t.response?.data?.message||t.message||"Произошла ошибка при сохранении заметки",type:"error"})}finally{this.isSubmitting=!1}},async clearForm(){if(this.isEditing=!1,this.hasUnsavedChanges=!1,this.note?.file){const t=await this.fetchMarkdownFile(this.note.file);this.markdownContent=t}else this.markdownContent="";this.editedNote={title:this.note?.title||"",description:this.note?.description||"",category:this.note?.category||"",text:this.note?.text||""}}}};const X=(0,M.A)(V,[["render",y],["__scopeId","data-v-ef3fde9e"]]);var T=X},873:function(t,e,i){var n=i(325),o=n.Symbol;t.exports=o},906:function(t,e,i){"use strict";i.d(e,{A:function(){return m}});var n=i(641),o=i(33);const a={class:"state-view"},s={class:"state-content"},r={class:"state-animation"},d={class:"state-message"};function l(t,e,i,l,c,u){const h=(0,n.g2)("RiveAnimation");return(0,n.uX)(),(0,n.CE)("div",a,[(0,n.Lk)("div",s,[(0,n.Lk)("div",r,[(0,n.bF)(h,{src:i.animationSrc,width:u.animationSize,height:u.animationSize,"state-machines":"State Machine 1"},null,8,["src","width","height"])]),(0,n.Lk)("div",d,[(0,n.Lk)("h2",null,(0,o.v_)(i.title),1),(0,n.Lk)("p",null,(0,o.v_)(i.message),1)])])])}var c=i(272),u={name:"StateView",components:{RiveAnimation:c.A},props:{title:{type:String,required:!0},message:{type:String,required:!0},animationSrc:{type:String,required:!0}},computed:{animationSize(){return window.innerWidth<768?300:400}}},h=i(262);const f=(0,h.A)(u,[["render",l],["__scopeId","data-v-7c8bd82a"]]);var m=f}}]);
//# sourceMappingURL=869.585d5ca1.js.map